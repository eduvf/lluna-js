<!DOCTYPE html>
<html lang="en">
	<head>
		<meta charset="UTF-8" />
		<meta http-equiv="X-UA-Compatible" content="IE=edge" />
		<meta name="viewport" content="width=device-width, initial-scale=1.0" />
		<title>&gt;_ lluna term js</title>
		<link
			rel="stylesheet"
			href="https://cdn.jsdelivr.net/npm/water.css@2/out/water.css" />
	</head>
	<style>
		:root {
			--purple-dark: #220011;
			--purple-mid: #331122;
			--purple-light: #442233;
			--orange: #ff9933;
			--yellow: #ffff88;

			/* Overwrite water.css */
			--background-body: var(--purple-mid);
			--background: var(--purple-dark);
			--button-base: var(--purple-dark);
			--button-hover: var(--purple-light);
			--form-text: var(--yellow);
			--text-bright: var(--yellow);
			--code: var(--yellow);
			--links: var(--orange);
			--focus: var(--orange);
			--selection: var(--orange);
			--border: var(--orange);
		}
	</style>
	<body>
		<header>
			<img
				src="https://raw.githubusercontent.com/eduvf/lluna-js/main/logo.svg"
				width="200"
				style="float: right" />
			<h1>
				&gt;_ lluna term js
				<sub style="font-size: small">&beta; version</sub>
			</h1>
			<a href="https://github.com/eduvf/lluna-js"
				><sup>[go to project page]</sup></a
			>
		</header>

		<hr />

		<form>
			<textarea
				id="inp"
				style="font-family: monospace"
				placeholder="Enter your lluna code here..."
				onkeydown="window.check_key(event)"></textarea>
		</form>
		<div style="display: flex">
			<select onchange="window.example()" id="sel" style="width: 100%">
				<option value="" disabled selected>examples:</option>
				<option value="hello">hello, moon!</option>
				<option value="factorial">factorial</option>
				<option value="fibonacci">fibonacci</option>
				<option value="loop">loop 0 to 10</option>
			</select>
			<button style="width: 100%" onclick="window.clear_in()">
				clear code
			</button>
			<button style="width: 100%" onclick="window.clear_out()">
				clear output
			</button>
			<button style="width: 100%" onclick="window.run_code()">run</button>
		</div>

		<pre>
            <code id="out"></code>
        </pre>

		<script type="module">
			import { read } from './read.js';
			import { lib } from './lib.js';
			import { run } from './run.js';
			const sel = document.getElementById('sel');
			const inp = document.getElementById('inp');
			const out = document.getElementById('out');

			// Change '->'
			let env = lib(run);
			env[0]['->'] = (arg, env) => {
				let l = arg.map((a) => run(a, env));
				// console.log(l.join(' '));
				// change to:
				out.innerText += l.join(' ') + '\n';
				return l;
			};

			function fetch_exec(url, f) {
				fetch(url).then((response) => {
					response.text().then((text) => {
						f(text);
					});
				});
			}
			window.check_key = (event) => {
				if (event.keyCode === 13 && event.ctrlKey) {
					run_code();
				}
			};
			window.run_code = () => {
				let r = run(read(inp.value), env);
				out.innerText += '> ' + r + '\n';
			};
			window.clear_in = () => {
				inp.value = '';
			};
			window.clear_out = () => {
				out.innerText = '';
			};
			window.example = () => {
				let opt = sel.value;
				let url =
					'https://raw.githubusercontent.com/eduvf/lluna-js/main/examples/' +
					opt +
					'.lluna';
				fetch_exec(url, (t) => (inp.value = t));
			};
		</script>
	</body>
</html>
